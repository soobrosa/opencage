<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POI Check-In</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 1em; }
    h1 { font-size: 1.5em; }
    #pois { margin-top: 1em; }
    .poi { margin-bottom: 1em; padding: 0.5em; border: 1px solid #ccc; border-radius: 8px; }
    button { margin-top: 0.5em; }
  </style>
</head>
<body>

<h1>Nearby POI Check-In</h1>
<p id="status">Getting your location...</p>
<div id="pois"></div>

<script>
async function fetchPOIs(lat, lon) {
  const radius = 500; // meters
  const query = `
    [out:json];
    (
      node(around:${radius},${lat},${lon})["amenity"];
      way(around:${radius},${lat},${lon})["amenity"];
      relation(around:${radius},${lat},${lon})["amenity"];
    );
    out center;
  `;

  const response = await fetch("https://overpass-api.de/api/interpreter", {
    method: "POST",
    body: query,
  });

  const data = await response.json();
  return data.elements;
}

function displayPOIs(pois) {
  const container = document.getElementById("pois");
  container.innerHTML = "";

  if (pois.length === 0) {
    container.textContent = "No POIs found within 500m.";
    return;
  }

  pois.forEach((poi, i) => {
    const name = poi.tags.name || "(Unnamed)";
    const type = poi.tags.amenity || "Unknown";
    const div = document.createElement("div");
    div.className = "poi";
    div.innerHTML = `<strong>${name}</strong><br><em>${type}</em><br>`;
    
    const btn = document.createElement("button");
    btn.textContent = "Check In";
    btn.onclick = () => alert(`Checked in to: ${name}`);
    div.appendChild(btn);

    container.appendChild(div);
  });
}

function showError(error) {
  document.getElementById("status").textContent = "Error: " + error.message;
}

navigator.geolocation.getCurrentPosition(async (position) => {
  const lat = position.coords.latitude;
  const lon = position.coords.longitude;

  document.getElementById("status").textContent = `Searching POIs near ${lat.toFixed(5)}, ${lon.toFixed(5)}...`;

  try {
    const pois = await fetchPOIs(lat, lon);
    document.getElementById("status").textContent = `Found ${pois.length} POIs:`;
    displayPOIs(pois);
  } catch (err) {
    showError(err);
  }
}, showError, { enableHighAccuracy: true });
</script>

</body>
</html>
